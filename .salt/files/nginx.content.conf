{% set cfg = salt['mc_utils.json_load'](data).cfg%}
{% set data = cfg.data %}
add_header Access-Control-Allow-Origin *;
gzip on;
gzip_types text/text text/html text/plain text/xml text/css application/x-javascript application/javascript application/json;
include mime.types;
types {
  application/json .geojson;
  application/gpx+xml .gpx;
  application/vnd.google-earth.kml+xml .kml;
  application/vnd.google-earth.kmz .kmz;
}

location /static/ {
    if ($query_string ~ .*(jpe?g|png|gif|js|css)$ ) {
      expires 1h;
      add_header Pragma public;
      add_header Cache-Control "public";
    }
    alias {{cfg.project_root}}/var/static/;
}
location /media/ {
    if ($query_string ~ .*(jpe?g|png|gif|js|css)$ ) {
      expires 1h;
      add_header Pragma public;
      add_header Cache-Control "public";
    }
    alias {{cfg.project_root}}/var/input/media/;
}
location / {
    #proxy_set_header Host $http_host;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-NginX-Proxy true;
    proxy_http_version 1.1;
    proxy_redirect off;
    proxy_pass http://{{cfg.name}}app;
}
