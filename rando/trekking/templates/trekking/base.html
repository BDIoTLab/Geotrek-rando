{% load i18n static leaflet_tags compress trekking ganalytics %}
<!DOCTYPE html>
<!--[if IEMobile 7 ]>    <html class="no-js iem7" lang="{{ request.LANGUAGE_CODE }}"> <![endif]-->
<!--[if (gt IEMobile 7)|!(IEMobile)]><!--> <html class="no-js" lang="{{ request.LANGUAGE_CODE }}"> <!--<![endif]-->
    <head>
        <!-- VERSION : {{ VERSION }} -->
        {% block head %}
        <meta charset="utf-8">
        <meta name="author" content="Makina Corpus">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>{% block title %}{{ TITLE }}{% endblock title %}</title>
        <meta name="language" content="{{ request.LANGUAGE_CODE }}" >
        <meta name="description" content="{% block description %}{{ DESCRIPTION }}{% endblock description %}" >
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta http-equiv="cleartype" content="on">

        {% if PREPROD %}
        <meta name="robots" content="noindex" />
        {% endif %}

        <link rel="shortcut icon" href="{% static "ico/favicon.ico" %}">

        <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/touch/apple-touch-icon-144x144-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/touch/apple-touch-icon-114x114-precomposed.png">
        <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/touch/apple-touch-icon-72x72-precomposed.png">
        <link rel="apple-touch-icon-precomposed" href="img/touch/apple-touch-icon-57x57-precomposed.png">
        <link rel="shortcut icon" href="img/touch/apple-touch-icon.png">

        <!-- Tile icon for Win8 (144x144 + tile color) -->
        <meta name="msapplication-TileImage" content="img/touch/apple-touch-icon-144x144-precomposed.png">
        <meta name="msapplication-TileColor" content="#222222">


        <!-- For iOS web apps. Delete if not needed. https://github.com/h5bp/mobile-boilerplate/issues/94 -->
        <!--
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-title" content="">
        -->

        <!-- This script prevents links from opening in Mobile Safari. https://gist.github.com/1042026 -->
        <!--
        <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
        -->

        <link href='http://fonts.googleapis.com/css?family=Open+Sans:700' rel='stylesheet' type='text/css'>

        {% compress css %}
        {% leaflet_css %}
        <!-- <link rel="stylesheet" href="{% static "css/normalize.css" %}"> -->
        <link rel="stylesheet" href="{% static "css/bootstrap.css" %}">
        <link rel="stylesheet" href="{% static "css/bootstrap-responsive.css" %}">
        <link rel="stylesheet" href="{% static "css/jquery-ui.css" %}">
        <link rel="stylesheet" href="{% static "css/chosen.css" %}">
        <link rel="stylesheet" href="{% static "css/MarkerCluster.css" %}">
        <link rel="stylesheet" href="{% static "css/style.css" %}">
        {% endcompress %}

        <link rel="stylesheet" href="{{ MEDIA_URL }}style.css" />
        
        <script src="{% static "js/modernizr-2.6.2.min.js" %}"></script>
        {% endblock head %}

        {% block extrahead %}
        {% endblock extrahead %}

    </head>
    <body>
        <header>
            <!-- <div class="navbar-inner"> -->
              <!-- <div class="container">
                <div class="nav-collapse"> -->
                <a href="{% url trekking:home %}"><h1>{{ TITLE }}</h1></a>
                <!-- </div> -->
              <!-- </div> -->

                <a class="btn utils" id="global-share" href="#" title="{% trans "Share" %}">
                    <i class="icon"></i>{% trans "Share" %}
                <!-- <img src="{% static "img/share.png" %}"/> {% trans "Share" %} -->
                </a>
            <!-- </div> -->
            <!--  navbar-inner-->
        </header>
        <!-- navbar-->

        <div class="container-fluid" id="container-content">
            <div id="content">
                {% block content %}
                {% endblock content %}
            </div>

            <div id="mainmap"></div>
        </div>
        <!-- container -->

        <footer id="footer" class="footer">
            <div class="wrapper">
                {% fileinclude "footer.html" %}
            </div>
        </footer>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script type="text/javascript">window.jQuery || document.write('<script src="{% static "js/jquery.min.js" %}"><\/script>')</script>

        {% compress js %}
        <script src="{% static "js/jquery-ui.js" %}"></script>
        <script src="{% static "js/jquery.ui.touch-punch.min.js" %}"></script>
        <script src="{% static "js/jquery.sparkline.min.js" %}"></script>
        <script src="{% static "js/jquery.pjax.js" %}"></script>
        <script src="{% static "js/jquery.smartresize.js" %}"></script>
        {% leaflet_js %}
        <script type="text/javascript">L.Icon.Default.imagePath = '{% static "leaflet/images" %}';</script>
        <script src="{% static "js/leaflet.markercluster.js" %}"></script>
        <script src="{% static "js/bootstrap.min.js" %}"></script>
        <script src="{% static "js/leaflet-objectslayer.js" %}"></script>
        <script src="{% static "js/leaflet.restoreview.js" %}"></script>
        <script src="{% static "js/leaflet.textpath.js" %}"></script>
        <script src="{% static "js/rtree.js" %}"></script>
        <script src="{% static "js/chosen.jquery.min.js" %}"></script>
        <script src="{% static "js/socialite.js" %}"></script>
        <script src="{% static "js/Control.FullScreen.js" %}"></script>

        <script src="{% static "js/application/mbp.helpers.js" %}"></script>
        <script src="{% static "js/application/ui.js" %}"></script>
        <script src="{% static "js/application/filter.js" %}"></script>
        <script src="{% static "js/application/backpack.js" %}"></script> 
        <script src="{% static "js/application/map.js" %}"></script>
        {% endcompress %}
        <script type="text/javascript" src="{% url jsi18n %}"></script>

        {% if not donottrack %}
        {% ganalytics %}
        {% endif %}

        <script type="text/javascript">
            /*
            * A bunch of globals \o/
            */
            var trekFilter = null,
                backPack = null,
                treksLayer = null,
                poisMarkers = poisMarkers || {},
                trek = trek || null,
                trekLayer = trekLayer || null,
                pois = pois || null,
                altimetric_url = altimetric_url || null,
                treks = {{ treksjson|safe }},
                IMG_URL = "{% static "img" %}",
                MOBILE = false,  // Will be set in ui.js
                firstLoad = true,
                firstLoadMobile = true;

            // Default Google Analytics in case Do-Not-Track is set
            window._gaq = window._gaq || [];

            $(document).ready(function (e) {
                init_ui();
                page_load();

                firstLoad = false;
            });

            $(document).on('pjax:start', function (e) {
                console.log('pjax start');
                page_leave();
            });

            $(document).on('pjax:end', function (e) {
                console.log('pjax end');
                var mainmapContainer = L.DomUtil.get('mainmap');
                if (mainmapContainer && typeof(loadmapmainmap) == "function") {
                if (!mainmapContainer._leaflet) loadmapmainmap();
                }
                var detailmapContainer = L.DomUtil.get('detailmap');
                if (detailmapContainer && typeof(loadmapdetailmap) == "function") {
                if (!detailmapContainer._leaflet) loadmapdetailmap();
                }
                page_load();
            });
        </script>
    </body>
</html>
