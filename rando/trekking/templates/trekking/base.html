{% load i18n static leaflet_tags compress trekking ganalytics %}
<!DOCTYPE html>
<html>
<head>
    <!-- VERSION : {{ VERSION }} -->
    {% block head %}
    <title>{% block title %}{{ TITLE }}{% endblock title %}</title>
    <meta name="language" content="{{ request.LANGUAGE_CODE }}" >
    <meta name="description" content="{% block description %}{{ DESCRIPTION }}{% endblock description %}" >
    <link rel="shortcut icon" href="{% static "ico/favicon.ico" %}">
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script src="{% static "js/html5.js" %}"pt>
    <![endif]-->
    {% compress css %}
    {% leaflet_css %}
    <link href="{% static "css/bootstrap.css" %}" rel="stylesheet">
    <link href="{% static "css/bootstrap-responsive.css" %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static "css/jquery-ui.css" %}" />
    <link rel="stylesheet" href="{% static "css/chosen.css" %}" />
    <link rel="stylesheet" href="{% static "css/style.css" %}" />
    <link href="{% static "css/MarkerCluster.css" %}" rel="stylesheet">
    {% endcompress %}

    <link rel="stylesheet" href="{{ MEDIA_URL }}style.css" />
    {% endblock head %}

    {% block extrahead %}
    {% endblock extrahead %}
</head>
<body>
  <div id="header" class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <div class="nav-collapse">
          <a href="{% url trekking:home %}"><h3>{{ TITLE }}</h3></a>
        </div>
      </div>

      <a class="btn" id="global-share" href="#" title="{% trans "Share" %}">
        <img src="{% static "img/share.png" %}"/> {% trans "Share" %}
      </a>

      <div id="social-panel" style="display: none;">
        <ul class="social-buttons cf">
        <li><a href="//twitter.com/share" class="socialite twitter-share" data-text="{{ TITLE }}" data-url="{{ request.build_absolute_uri }}" data-count="vertical" rel="nofollow" target="_blank"><span class="vhidden">{% trans "Twitter" %}</span></a></li>
        <li><a href="//plus.google.com/share?url={{ request.build_absolute_uri|iriencode }}" class="socialite googleplus-one" data-size="tall" data-href="{{ request.build_absolute_uri }}" rel="nofollow" target="_blank"><span class="vhidden">{% trans "Google+" %}</span></a></li>
        <li><a href="//www.facebook.com/sharer.php?u={{ request.build_absolute_uri|iriencode }}&t={{ TITLE }}" class="socialite facebook-like" data-href="{{ request.build_absolute_uri }}" data-send="false" data-layout="box_count" data-width="60" data-show-faces="false" rel="nofollow" target="_blank"><span class="vhidden">{% trans "Facebook" %}</span></a></li>
        </ul>
      </div>

    </div>
    <!--  navbar-inner-->
  </div>
  <!-- navbar-->

  <div class="container" id="container-content">

    <div id="mainmap"></div>

    <div id="content">
        {% block content %}
        {% endblock content %}
    </div>

  </div>
  <!-- container -->

  <footer id="footer" class="footer">
    {% fileinclude "footer.html" %}
  </footer>

  {% compress js %}
  <script src="{% static "js/jquery.min.js" %}" type="text/javascript"></script>
  <script src="{% static "js/jquery-ui.js" %}"></script>
  <script src="{% static "js/jquery.sparkline.min.js" %}"></script>
  <script src="{% static "js/jquery.pjax.js" %}"></script>
  {% leaflet_js %}
  <script type="text/javascript">
    L.Icon.Default.imagePath = '{% static "leaflet/images" %}';
  </script>
  <script src="{% static "js/leaflet.markercluster.js" %}"></script>
  <script src="{% static "js/bootstrap.min.js" %}"></script>
  <script src="{% static "js/leaflet-objectslayer.js" %}"></script>
  <script src="{% static "js/rtree.js" %}"></script>
  <script src="{% static "js/chosen.jquery.min.js" %}"></script>
  <script src="{% static "js/socialite.min.js" %}"></script>

  <script src="{% static "js/application/ui.js" %}"></script>
  <script src="{% static "js/application/filter.js" %}"></script>
  <script src="{% static "js/application/backpack.js" %}"></script> 
  <script src="{% static "js/application/map.js" %}"></script> 
  {% endcompress %}

  {% ganalytics %}

  <script type="text/javascript">

      /*
       * A bunch of globals \o/
       */
      var trekFilter = null,
          backPack = null,
          treksLayer = null,
          treks = {{ treksjson|safe }};

      $(document).ready(function (e) {
          init_ui();
          page_load();
      });

      $(document).on('pjax:end', function (e) {
          page_load();
          // Try a custom lazy load
          var mainmapContainer = L.DomUtil.get('mainmap');
          if (mainmapContainer && typeof(loadmapmainmap) == "function") {
              if (!mainmapContainer._leaflet) loadmapmainmap();
          }
          var detailmapContainer = L.DomUtil.get('detailmap');
          if (detailmapContainer && typeof(loadmapdetailmap) == "function") {
              if (!detailmapContainer._leaflet) loadmapdetailmap();
          }
      });
  </script>

</body>
</html>
